<!DOCTYPE html>
<html>

<head>
    <title>RAP Reset</title>
</head>

<body>
    <h1>Resetting RAP Database...</h1>
    <div id="status">Starting...</div>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzT7OIAlgLhved2naO9FKz4PiBn_2VSl9CK7epvZc8mr3hWcJpo4i77Kt3Mmr6kJ1V6eQ/exec";
        const API_TOKEN = "RAP_SECURE_TOKEN_2026_V1_ISAAC";

        const adminUser = {
            id: 'admin-001',
            name: 'Isaac Contreras',
            username: 'ISAAC',
            email: 'isaac@rap.mx',
            phone: '',
            cargo: 'Administrador',
            password: 'CONTRERAS9',
            role: 'admin',
            status: 'active',
            permissions: ['inventario', 'escaneo', 'eventos', 'eventos_edit', 'movimientos', 'estadisticas'],
            createdAt: new Date().toISOString()
        };

        async function runReset() {
            const statusEl = document.getElementById('status');
            try {
                statusEl.innerText = "Pushing users...";
                const resUsers = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for GAS redirect
                    body: JSON.stringify({
                        action: 'pushUsers',
                        token: API_TOKEN,
                        adminRole: 'admin',
                        users: [adminUser]
                    })
                });

                statusEl.innerText = "Clearing local cache...";
                localStorage.removeItem('rap_users_v2');
                localStorage.removeItem('rap_current_user');
                sessionStorage.removeItem('rap_current_user');

                statusEl.innerText = "Clearing notifications...";
                const resNotifs = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        action: 'push',
                        token: API_TOKEN,
                        notifications: []
                    })
                });

                statusEl.innerText = "RESET COMPLETED (Requests Sent)";
                console.log("Reset requests sent successfully");
            } catch (e) {
                statusEl.innerText = "Error: " + e.message;
                console.error("Reset failed", e);
            }
        }
        runReset();
    </script>
</body>

</html>